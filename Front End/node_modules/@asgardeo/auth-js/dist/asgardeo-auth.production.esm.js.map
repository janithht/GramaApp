{"version":3,"file":"asgardeo-auth.production.esm.js","sources":["../node_modules/tslib/tslib.es6.js","../src/constants/client-config.ts","../src/constants/oidc-endpoints.ts","../src/constants/custom-grant-template-tags.ts","../src/constants/data.ts","../src/constants/parameters.ts","../src/constants/scopes.ts","../src/constants/fetch.ts","../src/exception/exception.ts","../src/utils/authentication-utils.ts","../src/helpers/authentication-helper.ts","../src/helpers/crypto-helper.ts","../src/core/authentication-core.ts","../src/data/data-layer.ts","../src/client.ts"],"sourcesContent":["/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    var desc = Object.getOwnPropertyDescriptor(m, k);\r\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\r\n        desc = { enumerable: true, get: function() { return m[k]; } };\r\n    }\r\n    Object.defineProperty(o, k2, desc);\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n\r\nexport function __classPrivateFieldIn(state, receiver) {\r\n    if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\r\n    return typeof state === \"function\" ? receiver === state : state.has(receiver);\r\n}\r\n","/**\n * Copyright (c) 2020, WSO2 LLC. (https://www.wso2.com). All Rights Reserved.\n *\n * WSO2 LLC. licenses this file to you under the Apache License,\n * Version 2.0 (the \"License\"); you may not use this file except\n * in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied. See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nexport enum ResponseMode {\n    formPost = \"form_post\",\n    query = \"query\"\n}\n","/**\n * Copyright (c) 2019, WSO2 LLC. (https://www.wso2.com). All Rights Reserved.\n *\n * WSO2 LLC. licenses this file to you under the Apache License,\n * Version 2.0 (the \"License\"); you may not use this file except\n * in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied. See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { OIDCEndpoints } from \"../models\";\n\nexport const SERVICE_RESOURCES: OIDCEndpoints  = {\n    authorizationEndpoint: \"/oauth2/authorize\",\n    checkSessionIframe: \"/oidc/checksession\",\n    endSessionEndpoint: \"/oidc/logout\",\n    issuer: \"/oauth2/token\",\n    jwksUri: \"/oauth2/jwks\",\n    revocationEndpoint: \"/oauth2/revoke\",\n    tokenEndpoint: \"/oauth2/token\",\n    userinfoEndpoint: \"/oauth2/userinfo\"\n};\n\nexport const AUTHORIZATION_ENDPOINT: string = \"authorization_endpoint\";\nexport const TOKEN_ENDPOINT: string = \"token_endpoint\";\nexport const REVOKE_TOKEN_ENDPOINT: string = \"revocation_endpoint\";\nexport const END_SESSION_ENDPOINT: string = \"end_session_endpoint\";\nexport const JWKS_ENDPOINT: string = \"jwks_uri\";\nexport const OP_CONFIG_INITIATED: string = \"op_config_initiated\";\nexport const TENANT: string = \"tenant\";\nexport const SIGN_IN_REDIRECT_URL: string = \"sign_in_redirect_url\";\nexport const SIGN_OUT_REDIRECT_URL: string = \"sign_out_redirect_url\";\nexport const OIDC_SESSION_IFRAME_ENDPOINT: string = \"check_session_iframe\";\nexport const OPEN_ID_CONFIG: string = \"open_id_config\";\nexport const REGISTRATION_ENDPOINT: string = \"registration_endpoint\";\nexport const USERINFO_ENDPOINT: string = \"userinfo_endpoint\";\nexport const INTROSPECTION_ENDPOINT: string = \"introspection_endpoint\";\nexport const ISSUER: string = \"issuer\";\n","/**\n * Copyright (c) 2020, WSO2 LLC. (https://www.wso2.com). All Rights Reserved.\n *\n * WSO2 LLC. licenses this file to you under the Apache License,\n * Version 2.0 (the \"License\"); you may not use this file except\n * in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied. See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nexport const TOKEN_TAG: string = \"{{token}}\";\nexport const USERNAME_TAG: string = \"{{username}}\";\nexport const SCOPE_TAG: string = \"{{scope}}\";\nexport const CLIENT_ID_TAG: string = \"{{clientID}}\";\nexport const CLIENT_SECRET_TAG: string = \"{{clientSecret}}\";\n","/**\n * Copyright (c) 2020, WSO2 LLC. (https://www.wso2.com). All Rights Reserved.\n *\n * WSO2 LLC. licenses this file to you under the Apache License,\n * Version 2.0 (the \"License\"); you may not use this file except\n * in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied. See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nexport enum Stores {\n    ConfigData = \"config_data\",\n    OIDCProviderMetaData = \"oidc_provider_meta_data\",\n    SessionData = \"session_data\",\n    TemporaryData = \"temporary_data\"\n}\n\nexport const REFRESH_TOKEN_TIMER: string = \"refresh_token_timer\";\nexport const PKCE_CODE_VERIFIER: string = \"pkce_code_verifier\";\nexport const PKCE_SEPARATOR: string = \"#\";\n\nexport const SUPPORTED_SIGNATURE_ALGORITHMS: string[] = [\n    \"RS256\", \"RS512\", \"RS384\", \"PS256\"\n];\n","/**\n * Copyright (c) 2020, WSO2 LLC. (https://www.wso2.com). All Rights Reserved.\n *\n * WSO2 LLC. licenses this file to you under the Apache License,\n * Version 2.0 (the \"License\"); you may not use this file except\n * in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied. See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nexport const AUTHORIZATION_CODE: string = \"code\";\nexport const SESSION_STATE: string = \"session_state\";\nexport const SIGN_OUT_URL: string = \"sign_out_url\";\nexport const SIGN_OUT_SUCCESS_PARAM: string = \"sign_out_success\";\nexport const STATE: string = \"state\";\n","/**\n * Copyright (c) 2020, WSO2 LLC. (https://www.wso2.com). All Rights Reserved.\n *\n * WSO2 LLC. licenses this file to you under the Apache License,\n * Version 2.0 (the \"License\"); you may not use this file except\n * in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied. See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nexport const OIDC_SCOPE: string = \"openid\";\n","/**\n * Copyright (c) 2020, WSO2 LLC. (https://www.wso2.com). All Rights Reserved.\n *\n * WSO2 LLC. licenses this file to you under the Apache License,\n * Version 2.0 (the \"License\"); you may not use this file except\n * in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied. See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nexport enum FetchCredentialTypes {\n    Include = \"include\",\n    SameOrigin = \"same-origin\",\n    Omit = \"omit\"\n}\n","/**\n * Copyright (c) 2020, WSO2 LLC. (https://www.wso2.com). All Rights Reserved.\n *\n * WSO2 LLC. licenses this file to you under the Apache License,\n * Version 2.0 (the \"License\"); you may not use this file except\n * in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied. See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nexport class AsgardeoAuthException {\n    public name: string;\n    public code: string | undefined;\n    public message: string;\n\n    public constructor(\n        code: string,\n        name: string,\n        message: string\n    ) {\n        this.message = message;\n        this.name = name;\n        this.code = code;\n        Object.setPrototypeOf(this, new.target.prototype);\n    }\n}\n","/**\n * Copyright (c) 2020, WSO2 LLC. (https://www.wso2.com). All Rights Reserved.\n *\n * WSO2 LLC. licenses this file to you under the Apache License,\n * Version 2.0 (the \"License\"); you may not use this file except\n * in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied. See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { PKCE_CODE_VERIFIER, PKCE_SEPARATOR } from \"../constants\";\nimport { DecodedIDTokenPayload } from \"../models\";\n\nexport class AuthenticationUtils {\n    // eslint-disable-next-line @typescript-eslint/no-empty-function\n    private constructor() {}\n\n    public static filterClaimsFromIDTokenPayload(payload: DecodedIDTokenPayload): any {\n        const optionalizedPayload: Partial<DecodedIDTokenPayload> = { ...payload };\n\n        delete optionalizedPayload?.iss;\n        delete optionalizedPayload?.aud;\n        delete optionalizedPayload?.exp;\n        delete optionalizedPayload?.iat;\n        delete optionalizedPayload?.acr;\n        delete optionalizedPayload?.amr;\n        delete optionalizedPayload?.azp;\n        delete optionalizedPayload?.auth_time;\n        delete optionalizedPayload?.nonce;\n        delete optionalizedPayload?.c_hash;\n        delete optionalizedPayload?.at_hash;\n        delete optionalizedPayload?.nbf;\n        delete optionalizedPayload?.isk;\n        delete optionalizedPayload?.sid;\n\n        const camelCasedPayload : any= {};\n\n        Object.entries(optionalizedPayload).forEach(([ key, value ]: [ key: string, value: unknown ]) => {\n            const keyParts: string[] = key.split(\"_\");\n\n            const camelCasedKey: string = keyParts\n                .map((key: string, index: number) => {\n                    if (index === 0) {\n                        return key;\n                    }\n\n                    return [ key[ 0 ].toUpperCase(), ...key.slice(1) ].join(\"\");\n                })\n                .join(\"\");\n\n            camelCasedPayload[camelCasedKey] = value;\n        });\n\n        return camelCasedPayload;\n    }\n\n    /**\n     * @deprecated since v1.0.6 and will be removed with the v2.0.0 release.\n     */\n    public static getTenantDomainFromIdTokenPayload = (\n        payload: DecodedIDTokenPayload,\n        uidSeparator: string = \"@\"\n    ): string => {\n        // Try to extract the tenant domain from the `sub` claim.\n        const uid: string = payload.sub;\n        const tokens: string[] = uid.split(uidSeparator);\n\n        // This works only when the email is used as the username\n        // and the tenant domain is appended to the`sub` attribute.\n        return tokens.length > 2 ? tokens[tokens.length - 1] : \"\";\n    };\n\n    public static getTokenRequestHeaders(): HeadersInit {\n        return {\n            Accept: \"application/json\",\n            \"Content-Type\": \"application/x-www-form-urlencoded\"\n        };\n    }\n\n    /**\n     * This generates the state param value to be sent with an authorization request.\n     *\n     * @param pkceKey - The PKCE key.\n     * @param state - The state value to be passed. (The correlation ID will be appended to this state value.)\n     *\n     * @returns The state param value.\n     */\n    public static generateStateParamForRequestCorrelation(pkceKey: string, state?: string): string {\n        const index: number = parseInt(pkceKey.split(PKCE_SEPARATOR)[1]);\n\n        return state ? `${state}_request_${index}` : `request_${index}`;\n    }\n\n    public static extractPKCEKeyFromStateParam(stateParam: string): string {\n        const index: number = parseInt(stateParam.split(\"request_\")[1]);\n\n        return `${PKCE_CODE_VERIFIER}${PKCE_SEPARATOR}${index}`;\n    }\n}\n","/**\n * Copyright (c) 2020, WSO2 LLC. (https://www.wso2.com). All Rights Reserved.\n *\n * WSO2 LLC. licenses this file to you under the Apache License,\n * Version 2.0 (the \"License\"); you may not use this file except\n * in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied. See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { CryptoHelper } from \"./crypto-helper\";\nimport {\n    AUTHORIZATION_ENDPOINT,\n    CLIENT_ID_TAG,\n    CLIENT_SECRET_TAG,\n    END_SESSION_ENDPOINT,\n    FetchCredentialTypes,\n    ISSUER,\n    JWKS_ENDPOINT,\n    OIDC_SCOPE,\n    OIDC_SESSION_IFRAME_ENDPOINT,\n    PKCE_CODE_VERIFIER,\n    PKCE_SEPARATOR,\n    REVOKE_TOKEN_ENDPOINT,\n    SCOPE_TAG,\n    SERVICE_RESOURCES,\n    TOKEN_ENDPOINT,\n    TOKEN_TAG,\n    USERINFO_ENDPOINT,\n    USERNAME_TAG\n} from \"../constants\";\nimport { DataLayer } from \"../data\";\nimport { AsgardeoAuthException } from \"../exception\";\nimport {\n    AuthClientConfig,\n    AuthenticatedUserInfo,\n    DecodedIDTokenPayload,\n    JWKInterface,\n    OIDCEndpointsInternal,\n    OIDCProviderMetaData,\n    RawTokenResponse,\n    SessionData,\n    StrictAuthClientConfig,\n    TemporaryData,\n    TokenResponse\n} from \"../models\";\nimport { AuthenticationUtils } from \"../utils\";\n\nexport class AuthenticationHelper<T> {\n    private _dataLayer: DataLayer<T>;\n    private _config: () => Promise<AuthClientConfig>;\n    private _oidcProviderMetaData: () => Promise<OIDCProviderMetaData>;\n    private _cryptoHelper: CryptoHelper;\n\n    public constructor(dataLayer: DataLayer<T>, cryptoHelper: CryptoHelper) {\n        this._dataLayer = dataLayer;\n        this._config = async () => await this._dataLayer.getConfigData();\n        this._oidcProviderMetaData = async () => await this._dataLayer.getOIDCProviderMetaData();\n        this._cryptoHelper = cryptoHelper;\n    }\n\n    public async resolveEndpoints(response: OIDCProviderMetaData): Promise<OIDCProviderMetaData> {\n        const oidcProviderMetaData: OIDCProviderMetaData = {};\n        const configData: StrictAuthClientConfig = await this._config();\n\n        configData.endpoints &&\n            Object.keys(configData.endpoints).forEach((endpointName: string) => {\n                const snakeCasedName: string = endpointName\n                    .replace(/[A-Z]/g, (letter: string) => `_${ letter.toLowerCase() }`);\n\n                oidcProviderMetaData[ snakeCasedName ] = configData?.endpoints\n                    ? configData.endpoints[ endpointName ]\n                    : \"\";\n            });\n\n        return { ...response, ...oidcProviderMetaData };\n    }\n\n    public async resolveEndpointsExplicitly(): Promise<OIDCEndpointsInternal> {\n        const oidcProviderMetaData: OIDCProviderMetaData = {};\n        const configData: StrictAuthClientConfig = await this._config();\n\n        const requiredEndpoints: string[] = [\n            AUTHORIZATION_ENDPOINT,\n            END_SESSION_ENDPOINT,\n            JWKS_ENDPOINT,\n            OIDC_SESSION_IFRAME_ENDPOINT,\n            REVOKE_TOKEN_ENDPOINT,\n            TOKEN_ENDPOINT,\n            ISSUER,\n            USERINFO_ENDPOINT\n        ];\n\n        const isRequiredEndpointsContains: boolean = configData.endpoints\n            ? requiredEndpoints.every((reqEndpointName: string) => {\n                return configData.endpoints\n                    ? Object.keys(configData.endpoints).some((endpointName: string) => {\n                        const snakeCasedName: string = endpointName.replace(\n                            /[A-Z]/g,\n                            (letter: string) => `_${ letter.toLowerCase() }`\n                        );\n\n                        return snakeCasedName === reqEndpointName;\n                    })\n                    : false;\n            })\n            : false;\n\n        if (!isRequiredEndpointsContains) {\n            throw new AsgardeoAuthException(\n                \"JS-AUTH_HELPER-REE-NF01\",\n                \"Required endpoints missing\",\n                \"Some or all of the required endpoints are missing in the object passed to the `endpoints` \" +\n                \"attribute of the`AuthConfig` object.\"\n            );\n        }\n\n        configData.endpoints &&\n            Object.keys(configData.endpoints).forEach((endpointName: string) => {\n                const snakeCasedName: string = endpointName\n                    .replace(/[A-Z]/g, (letter: string) => `_${ letter.toLowerCase() }`);\n\n                oidcProviderMetaData[ snakeCasedName ] = configData?.endpoints\n                    ? configData.endpoints[ endpointName ]\n                    : \"\";\n            });\n\n        return { ...oidcProviderMetaData };\n    }\n\n    public async resolveEndpointsByBaseURL(): Promise<OIDCEndpointsInternal> {\n        const oidcProviderMetaData: OIDCEndpointsInternal = {};\n        const configData: StrictAuthClientConfig = await this._config();\n\n        const baseUrl: string = (configData as any).baseUrl;\n\n        if (!baseUrl) {\n            throw new AsgardeoAuthException(\n                \"JS-AUTH_HELPER_REBO-NF01\",\n                \"Base URL not defined.\",\n                \"Base URL is not defined in AuthClient config.\"\n            );\n        }\n\n        configData.endpoints &&\n            Object.keys(configData.endpoints).forEach((endpointName: string) => {\n                const snakeCasedName: string = endpointName\n                    .replace(/[A-Z]/g, (letter: string) => `_${ letter.toLowerCase() }`);\n\n                oidcProviderMetaData[ snakeCasedName ] = configData?.endpoints\n                    ? configData.endpoints[ endpointName ]\n                    : \"\";\n            });\n\n        const defaultEndpoints: OIDCProviderMetaData = {\n            [ AUTHORIZATION_ENDPOINT ]: `${baseUrl}${SERVICE_RESOURCES.authorizationEndpoint}`,\n            [ END_SESSION_ENDPOINT ]: `${baseUrl}${SERVICE_RESOURCES.endSessionEndpoint}`,\n            [ ISSUER ]: `${baseUrl}${SERVICE_RESOURCES.issuer}`,\n            [ JWKS_ENDPOINT ]: `${baseUrl}${SERVICE_RESOURCES.jwksUri}`,\n            [ OIDC_SESSION_IFRAME_ENDPOINT ]: `${baseUrl}${SERVICE_RESOURCES.checkSessionIframe}`,\n            [ REVOKE_TOKEN_ENDPOINT ]: `${baseUrl}${SERVICE_RESOURCES.revocationEndpoint}`,\n            [ TOKEN_ENDPOINT ]: `${baseUrl}${SERVICE_RESOURCES.tokenEndpoint}`,\n            [ USERINFO_ENDPOINT ]: `${baseUrl}${SERVICE_RESOURCES.userinfoEndpoint}`\n        };\n\n        return { ...defaultEndpoints, ...oidcProviderMetaData };\n    }\n\n    public async validateIdToken(idToken: string): Promise<boolean> {\n        const jwksEndpoint: string | undefined = (await this._dataLayer.getOIDCProviderMetaData()).jwks_uri;\n        const configData: StrictAuthClientConfig = await this._config();\n\n        if (!jwksEndpoint || jwksEndpoint.trim().length === 0) {\n            throw new AsgardeoAuthException(\n                \"JS_AUTH_HELPER-VIT-NF01\",\n                \"JWKS endpoint not found.\",\n                \"No JWKS endpoint was found in the OIDC provider meta data returned by the well-known endpoint \" +\n                \"or the JWKS endpoint passed to the SDK is empty.\"\n            );\n        }\n\n        let response: Response;\n\n        try {\n            response = await fetch(jwksEndpoint, {\n                credentials: configData.sendCookiesInRequests\n                    ? FetchCredentialTypes.Include\n                    : FetchCredentialTypes.SameOrigin\n            });\n        } catch (error: any) {\n            throw new AsgardeoAuthException(\n                \"JS-AUTH_HELPER-VIT-NE02\",\n                \"Request to jwks endpoint failed.\",\n                error ?? \"The request sent to get the jwks from the server failed.\"\n            );\n        }\n\n        if (response.status !== 200 || !response.ok) {\n            throw new AsgardeoAuthException(\n                \"JS-AUTH_HELPER-VIT-HE03\",\n                `Invalid response status received for jwks request (${ response.statusText }).`,\n                await response.json()\n            );\n        }\n\n        const issuer: string | undefined = (await this._oidcProviderMetaData()).issuer;\n\n        const { keys }: { keys: JWKInterface[]; } = await response.json();\n\n        const jwk: any = await this._cryptoHelper.getJWKForTheIdToken(idToken.split(\".\")[ 0 ], keys);\n\n        return this._cryptoHelper.isValidIdToken(\n            idToken,\n            jwk,\n            (await this._config()).clientID,\n            issuer ?? \"\",\n            this._cryptoHelper.decodeIDToken(idToken).sub,\n            (await this._config()).clockTolerance, \n            (await this._config()).validateIDTokenIssuer ?? true\n        );\n    }\n\n    public getAuthenticatedUserInfo(idToken: string): AuthenticatedUserInfo {\n        const payload: DecodedIDTokenPayload = this._cryptoHelper.decodeIDToken(idToken);\n        const tenantDomain: string = AuthenticationUtils.getTenantDomainFromIdTokenPayload(payload);\n        const username: string = payload?.username ?? \"\";\n        const givenName: string = payload.given_name ?? \"\";\n        const familyName: string = payload.family_name ?? \"\";\n        const fullName: string =\n            givenName && familyName\n                ? `${ givenName } ${ familyName }`\n                : givenName\n                    ? givenName\n                    : familyName\n                        ? familyName\n                        : \"\";\n        const displayName: string = payload.preferred_username ?? fullName;\n\n        return {\n            displayName: displayName,\n            tenantDomain,\n            username: username,\n            ...AuthenticationUtils.filterClaimsFromIDTokenPayload(payload)\n        };\n    }\n\n    public async replaceCustomGrantTemplateTags(text: string, userID?: string): Promise<string> {\n        let scope: string = OIDC_SCOPE;\n        const configData: StrictAuthClientConfig = await this._config();\n        const sessionData: SessionData = await this._dataLayer.getSessionData(userID);\n\n        if (configData.scope && configData.scope.length > 0) {\n            if (!configData.scope.includes(OIDC_SCOPE)) {\n                configData.scope.push(OIDC_SCOPE);\n            }\n            scope = configData.scope.join(\" \");\n        }\n\n        return text\n            .replace(TOKEN_TAG, sessionData.access_token)\n            .replace(USERNAME_TAG, this.getAuthenticatedUserInfo(sessionData.id_token).username)\n            .replace(SCOPE_TAG, scope)\n            .replace(CLIENT_ID_TAG, configData.clientID)\n            .replace(CLIENT_SECRET_TAG, configData.clientSecret ?? \"\");\n    }\n\n    public async clearUserSessionData(userID?: string): Promise<void> {\n        await this._dataLayer.removeTemporaryData(userID);\n        await this._dataLayer.removeSessionData(userID);\n    }\n\n    public async handleTokenResponse(response: Response, userID?: string): Promise<TokenResponse> {\n        if (response.status !== 200 || !response.ok) {\n            throw new AsgardeoAuthException(\n                \"JS-AUTH_HELPER-HTR-NE01\",\n                `Invalid response status received for token request (${ response.statusText }).`,\n                await response.json()\n            );\n        }\n\n        //Get the response in JSON\n        const parsedResponse: RawTokenResponse = await response.json();\n\n        parsedResponse.created_at = new Date().getTime();\n\n        if ((await this._config()).validateIDToken) {\n            return this.validateIdToken(parsedResponse.id_token).then(async () => {\n                await this._dataLayer.setSessionData(parsedResponse, userID);\n\n                const tokenResponse: TokenResponse = {\n                    accessToken: parsedResponse.access_token,\n                    createdAt: parsedResponse.created_at,\n                    expiresIn: parsedResponse.expires_in,\n                    idToken: parsedResponse.id_token,\n                    refreshToken: parsedResponse.refresh_token,\n                    scope: parsedResponse.scope,\n                    tokenType: parsedResponse.token_type\n                };\n\n                return Promise.resolve(tokenResponse);\n            });\n        } else {\n            const tokenResponse: TokenResponse = {\n                accessToken: parsedResponse.access_token,\n                createdAt: parsedResponse.created_at,\n                expiresIn: parsedResponse.expires_in,\n                idToken: parsedResponse.id_token,\n                refreshToken: parsedResponse.refresh_token,\n                scope: parsedResponse.scope,\n                tokenType: parsedResponse.token_type\n            };\n\n            await this._dataLayer.setSessionData(parsedResponse, userID);\n\n            return Promise.resolve(tokenResponse);\n        }\n    }\n\n    /**\n     * This generates a PKCE key with the right index value.\n     *\n     * @param userID - The userID to identify a user in a multi-user scenario.\n     *\n     * @returns The PKCE key.\n     */\n    public async generatePKCEKey(userID?: string): Promise<string> {\n        const tempData: TemporaryData = await this._dataLayer.getTemporaryData(userID);\n        const keys: string[] = [];\n\n        Object.keys(tempData).forEach((key: string) => {\n            if (key.startsWith(PKCE_CODE_VERIFIER)) {\n                keys.push(key);\n            }\n        });\n\n        const lastKey: string | undefined = keys.sort().pop();\n        const index: number = parseInt(lastKey?.split(PKCE_SEPARATOR)[ 1 ] ?? \"-1\");\n\n        return `${ PKCE_CODE_VERIFIER }${ PKCE_SEPARATOR }${ index + 1 }`;\n    }\n}\n","/**\n * Copyright (c) 2022, WSO2 LLC. (https://www.wso2.com). All Rights Reserved.\n *\n * WSO2 LLC. licenses this file to you under the Apache License,\n * Version 2.0 (the \"License\"); you may not use this file except\n * in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied. See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { SUPPORTED_SIGNATURE_ALGORITHMS } from \"../constants\";\nimport { AsgardeoAuthException } from \"../exception\";\nimport { CryptoUtils, DecodedIDTokenPayload, JWKInterface } from \"../models\";\n\nexport class CryptoHelper<T = any> {\n    private _cryptoUtils: CryptoUtils<T>;\n\n    public constructor(cryptoUtils: CryptoUtils<T>) {\n        this._cryptoUtils = cryptoUtils;\n    }\n\n    /**\n     * Generate code verifier.\n     *\n     * @returns code verifier.\n     */\n    public getCodeVerifier(): string {\n        return this._cryptoUtils.base64URLEncode(this._cryptoUtils.generateRandomBytes(32));\n    }\n\n    /**\n     * Derive code challenge from the code verifier.\n     *\n     * @param verifier - Code verifier.\n     *\n     * @returns - code challenge.\n     */\n    public getCodeChallenge(verifier: string): string {\n        return this._cryptoUtils.base64URLEncode(this._cryptoUtils.hashSha256(verifier));\n    }\n\n    /**\n     * Get JWK used for the id_token\n     *\n     * @param jwtHeader - header of the id_token.\n     * @param keys - jwks response.\n     *\n     * @returns public key.\n     *\n     * @throws\n     */\n    /* eslint-disable @typescript-eslint/no-explicit-any */\n    public getJWKForTheIdToken(jwtHeader: string, keys: JWKInterface[]): JWKInterface {\n        const headerJSON: Record<string, string> = JSON.parse(this._cryptoUtils.base64URLDecode(jwtHeader));\n\n        for (const key of keys) {\n            if (headerJSON.kid === key.kid) {\n                return key;\n            }\n        }\n\n        throw new AsgardeoAuthException(\n            \"JS-CRYPTO_UTIL-GJFTIT-IV01\",\n            \"kid not found.\",\n            \"Failed to find the 'kid' specified in the id_token. 'kid' found in the header : \" +\n            headerJSON.kid +\n            \", Expected values: \" +\n            keys.map((key: JWKInterface) => key.kid).join(\", \")\n        );\n    }\n\n    /**\n     * Verify id token.\n     *\n     * @param idToken - id_token received from the IdP.\n     * @param jwk - public key used for signing.\n     * @param clientID - app identification.\n     * @param issuer - id_token issuer.\n     * @param username - Username.\n     * @param clockTolerance - Allowed leeway for id_tokens (in seconds).\n     *\n     * @returns whether the id_token is valid.\n     *\n     * @throws\n     */\n    public isValidIdToken(\n        idToken: string,\n        jwk: JWKInterface,\n        clientID: string,\n        issuer: string,\n        username: string,\n        clockTolerance: number | undefined,\n        validateJwtIssuer: boolean | undefined\n    ): Promise<boolean> {\n        return this._cryptoUtils\n            .verifyJwt(\n                idToken, \n                jwk, \n                SUPPORTED_SIGNATURE_ALGORITHMS, \n                clientID, \n                issuer, \n                username, \n                clockTolerance, \n                validateJwtIssuer\n            )\n            .then((response: boolean) => {\n                if (response) {\n                    return Promise.resolve(true);\n                }\n\n                return Promise.reject(\n                    new AsgardeoAuthException(\n                        \"JS-CRYPTO_HELPER-IVIT-IV01\",\n                        \"Invalid ID token.\",\n                        \"ID token validation returned false\"\n                    )\n                );\n            });\n    }\n\n    /**\n     * This function decodes the payload of an id token and returns it.\n     *\n     * @param idToken - The id token to be decoded.\n     *\n     * @returns - The decoded payload of the id token.\n     *\n     * @throws\n     */\n    public decodeIDToken(idToken: string): DecodedIDTokenPayload {\n        try {\n            const utf8String: string = this._cryptoUtils.base64URLDecode(idToken.split(\".\")[ 1 ]);\n            const payload: DecodedIDTokenPayload = JSON.parse(utf8String);\n\n            return payload;\n        } catch (error: any) {\n            throw new AsgardeoAuthException(\"JS-CRYPTO_UTIL-DIT-IV01\", \"Decoding ID token failed.\", error);\n        }\n    }\n}\n","/**\n * Copyright (c) 2020, WSO2 LLC. (https://www.wso2.com). All Rights Reserved.\n *\n * WSO2 LLC. licenses this file to you under the Apache License,\n * Version 2.0 (the \"License\"); you may not use this file except\n * in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied. See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n    AUTHORIZATION_ENDPOINT,\n    FetchCredentialTypes,\n    OIDC_SCOPE,\n    OP_CONFIG_INITIATED,\n    SESSION_STATE,\n    SIGN_OUT_SUCCESS_PARAM,\n    STATE\n} from \"../constants\";\nimport { DataLayer } from \"../data\";\nimport { AsgardeoAuthException } from \"../exception\";\nimport { AuthenticationHelper, CryptoHelper } from \"../helpers\";\nimport {\n    AuthClientConfig,\n    AuthenticatedUserInfo,\n    AuthorizationURLParams,\n    BasicUserInfo,\n    CryptoUtils,\n    CustomGrantConfig,\n    DecodedIDTokenPayload,\n    FetchRequestConfig,\n    FetchResponse,\n    OIDCEndpoints,\n    OIDCProviderMetaData,\n    SessionData,\n    StrictAuthClientConfig,\n    TokenResponse\n} from \"../models\";\nimport { AuthenticationUtils } from \"../utils\";\n\nexport class AuthenticationCore<T> {\n    private _dataLayer: DataLayer<T>;\n    private _config: () => Promise<AuthClientConfig>;\n    private _oidcProviderMetaData: () => Promise<OIDCProviderMetaData>;\n    private _authenticationHelper: AuthenticationHelper<T>;\n    private _cryptoUtils: CryptoUtils;\n    private _cryptoHelper: CryptoHelper;\n\n    public constructor(dataLayer: DataLayer<T>, cryptoUtils: CryptoUtils) {\n        this._cryptoUtils = cryptoUtils;\n        this._cryptoHelper = new CryptoHelper(cryptoUtils);\n        this._authenticationHelper = new AuthenticationHelper(dataLayer, this._cryptoHelper);\n        this._dataLayer = dataLayer;\n        this._config = async () => await this._dataLayer.getConfigData();\n        this._oidcProviderMetaData = async () => await this._dataLayer.getOIDCProviderMetaData();\n    }\n\n    public async getAuthorizationURL(config?: AuthorizationURLParams, userID?: string): Promise<string> {\n        const authorizeEndpoint: string = (await this._dataLayer.getOIDCProviderMetaDataParameter(\n            AUTHORIZATION_ENDPOINT as keyof OIDCProviderMetaData\n        )) as string;\n\n        const configData: StrictAuthClientConfig = await this._config();\n\n        if (!authorizeEndpoint || authorizeEndpoint.trim().length === 0) {\n            throw new AsgardeoAuthException(\n                \"JS-AUTH_CORE-GAU-NF01\",\n                \"No authorization endpoint found.\",\n                \"No authorization endpoint was found in the OIDC provider meta data from the well-known endpoint \" +\n                \"or the authorization endpoint passed to the SDK is empty.\"\n            );\n        }\n\n        const authorizeRequest: URL = new URL(authorizeEndpoint);\n\n        const authorizeRequestParams: Map<string, string> = new Map<string, string>();\n\n        authorizeRequestParams.set(\"response_type\", \"code\");\n        authorizeRequestParams.set(\"client_id\", configData.clientID);\n\n        let scope: string = OIDC_SCOPE;\n\n        if (configData.scope && configData.scope.length > 0) {\n            if (!configData.scope.includes(OIDC_SCOPE)) {\n                configData.scope.push(OIDC_SCOPE);\n            }\n            scope = configData.scope.join(\" \");\n        }\n\n        authorizeRequestParams.set(\"scope\", scope);\n        authorizeRequestParams.set(\"redirect_uri\", configData.signInRedirectURL);\n\n        if (configData.responseMode) {\n            authorizeRequestParams.set(\"response_mode\", configData.responseMode);\n        }\n\n        const pkceKey: string = await this._authenticationHelper.generatePKCEKey(userID);\n\n        if (configData.enablePKCE) {\n            const codeVerifier: string = this._cryptoHelper?.getCodeVerifier();\n            const codeChallenge: string = this._cryptoHelper?.getCodeChallenge(codeVerifier);\n\n            await this._dataLayer.setTemporaryDataParameter(pkceKey, codeVerifier, userID);\n            authorizeRequestParams.set(\"code_challenge_method\", \"S256\");\n            authorizeRequestParams.set(\"code_challenge\", codeChallenge);\n        }\n\n        if (configData.prompt) {\n            authorizeRequestParams.set(\"prompt\", configData.prompt);\n        }\n\n        const customParams: AuthorizationURLParams | undefined = config;\n\n        if (customParams) {\n            for (const [ key, value ] of Object.entries(customParams)) {\n                if (key != \"\" && value != \"\" && key !== STATE) {\n                    authorizeRequestParams.set(key, value.toString());\n                }\n            }\n        }\n\n        authorizeRequestParams.set(\n            STATE,\n            AuthenticationUtils.generateStateParamForRequestCorrelation(\n                pkceKey,\n                customParams ? customParams[ STATE ]?.toString() : \"\"\n            )\n        );\n\n        for (const [ key, value ] of authorizeRequestParams.entries()) {\n            authorizeRequest.searchParams.append(key, value);\n        }\n\n        return authorizeRequest.toString();\n    }\n\n    public async requestAccessToken(\n        authorizationCode: string,\n        sessionState: string,\n        state: string,\n        userID?: string\n    ): Promise<TokenResponse> {\n        const tokenEndpoint: string | undefined = (await this._oidcProviderMetaData()).token_endpoint;\n        const configData: StrictAuthClientConfig = await this._config();\n\n        if (!tokenEndpoint || tokenEndpoint.trim().length === 0) {\n            throw new AsgardeoAuthException(\n                \"JS-AUTH_CORE-RAT1-NF01\",\n                \"Token endpoint not found.\",\n                \"No token endpoint was found in the OIDC provider meta data returned by the well-known endpoint \" +\n                \"or the token endpoint passed to the SDK is empty.\"\n            );\n        }\n\n        sessionState && (await this._dataLayer.setSessionDataParameter(\n            SESSION_STATE as keyof SessionData, sessionState, userID));\n\n        const body: URLSearchParams = new URLSearchParams();\n\n        body.set(\"client_id\", configData.clientID);\n\n        if (configData.clientSecret && configData.clientSecret.trim().length > 0) {\n            body.set(\"client_secret\", configData.clientSecret);\n        }\n\n        const code: string = authorizationCode;\n\n        body.set(\"code\", code);\n\n        body.set(\"grant_type\", \"authorization_code\");\n        body.set(\"redirect_uri\", configData.signInRedirectURL);\n\n        if (configData.enablePKCE) {\n            body.set(\n                \"code_verifier\", `${await this._dataLayer.getTemporaryDataParameter(\n                    AuthenticationUtils.extractPKCEKeyFromStateParam(state),\n                    userID\n                )}`\n            );\n\n            await this._dataLayer.removeTemporaryDataParameter(\n                AuthenticationUtils.extractPKCEKeyFromStateParam(state),\n                userID\n            );\n        }\n\n        let tokenResponse: Response;\n\n        try {\n            tokenResponse = await fetch(tokenEndpoint, {\n                body: body,\n                credentials: configData.sendCookiesInRequests\n                    ? FetchCredentialTypes.Include\n                    : FetchCredentialTypes.SameOrigin,\n                headers: new Headers(AuthenticationUtils.getTokenRequestHeaders()),\n                method: \"POST\"\n            });\n        } catch (error: any) {\n            throw new AsgardeoAuthException(\n                \"JS-AUTH_CORE-RAT1-NE02\",\n                \"Requesting access token failed\",\n                error ?? \"The request to get the access token from the server failed.\"\n            );\n        }\n\n        if (!tokenResponse.ok) {\n            throw new AsgardeoAuthException(\n                \"JS-AUTH_CORE-RAT1-HE03\",\n                `Requesting access token failed with ${tokenResponse.statusText}`,\n                await tokenResponse.json()\n            );\n        }\n\n        return await this._authenticationHelper.handleTokenResponse(tokenResponse, userID);\n    }\n\n    public async refreshAccessToken(userID?: string): Promise<TokenResponse> {\n        const tokenEndpoint: string | undefined = (await this._oidcProviderMetaData()).token_endpoint;\n        const configData: StrictAuthClientConfig = await this._config();\n        const sessionData: SessionData = await this._dataLayer.getSessionData(userID);\n\n        if (!sessionData.refresh_token) {\n            throw new AsgardeoAuthException(\n                \"JS-AUTH_CORE-RAT2-NF01\",\n                \"No refresh token found.\",\n                \"There was no refresh token found. Asgardeo doesn't return a \" +\n                \"refresh token if the refresh token grant is not enabled.\"\n            );\n        }\n\n        if (!tokenEndpoint || tokenEndpoint.trim().length === 0) {\n            throw new AsgardeoAuthException(\n                \"JS-AUTH_CORE-RAT2-NF02\",\n                \"No refresh token endpoint found.\",\n                \"No refresh token endpoint was in the OIDC provider meta data returned by the well-known \" +\n                \"endpoint or the refresh token endpoint passed to the SDK is empty.\"\n            );\n        }\n\n        const body: string[] = [];\n\n        body.push(`client_id=${ configData.clientID }`);\n        body.push(`refresh_token=${ sessionData.refresh_token }`);\n        body.push(\"grant_type=refresh_token\");\n\n        if (configData.clientSecret && configData.clientSecret.trim().length > 0) {\n            body.push(`client_secret=${ configData.clientSecret }`);\n        }\n\n        let tokenResponse: Response;\n\n        try {\n            tokenResponse = await fetch(tokenEndpoint, {\n                body: body.join(\"&\"),\n                credentials: configData.sendCookiesInRequests\n                    ? FetchCredentialTypes.Include\n                    : FetchCredentialTypes.SameOrigin,\n                headers: new Headers(AuthenticationUtils.getTokenRequestHeaders()),\n                method: \"POST\"\n            });\n        } catch (error: any) {\n            throw new AsgardeoAuthException(\n                \"JS-AUTH_CORE-RAT2-NR03\",\n                \"Refresh access token request failed.\",\n                error ?? \"The request to refresh the access token failed.\"\n            );\n        }\n\n        if (!tokenResponse.ok) {\n            throw new AsgardeoAuthException(\n                \"JS-AUTH_CORE-RAT2-HE04\",\n                `Refreshing access token failed with ${tokenResponse.statusText}`,\n                await tokenResponse.json()\n            );\n        }\n\n        return this._authenticationHelper.handleTokenResponse(tokenResponse, userID);\n    }\n\n    public async revokeAccessToken(userID?: string): Promise<FetchResponse> {\n        const revokeTokenEndpoint: string | undefined = (await this._oidcProviderMetaData()).revocation_endpoint;\n        const configData: StrictAuthClientConfig = await this._config();\n\n        if (!revokeTokenEndpoint || revokeTokenEndpoint.trim().length === 0) {\n            throw new AsgardeoAuthException(\n                \"JS-AUTH_CORE-RAT3-NF01\",\n                \"No revoke access token endpoint found.\",\n                \"No revoke access token endpoint was found in the OIDC provider meta data returned by \" +\n                \"the well-known endpoint or the revoke access token endpoint passed to the SDK is empty.\"\n            );\n        }\n\n        const body: string[] = [];\n\n        body.push(`client_id=${ configData.clientID }`);\n        body.push(`token=${ (await this._dataLayer.getSessionData(userID)).access_token }`);\n        body.push(\"token_type_hint=access_token\");\n\n        let response: Response;\n\n        try {\n            response = await fetch(revokeTokenEndpoint, {\n                body: body.join(\"&\"),\n                credentials: configData.sendCookiesInRequests\n                    ? FetchCredentialTypes.Include\n                    : FetchCredentialTypes.SameOrigin,\n                headers: new Headers(AuthenticationUtils.getTokenRequestHeaders()),\n                method: \"POST\"\n            });\n        } catch (error: any) {\n            throw new AsgardeoAuthException(\n                \"JS-AUTH_CORE-RAT3-NE02\",\n                \"The request to revoke access token failed.\",\n                error ?? \"The request sent to revoke the access token failed.\"\n            );\n        }\n\n        if (response.status !== 200 || !response.ok) {\n            throw new AsgardeoAuthException(\n                \"JS-AUTH_CORE-RAT3-HE03\",\n                `Invalid response status received for revoke access token request (${response.statusText}).`,\n                await response.json()\n            );\n        }\n\n        this._authenticationHelper.clearUserSessionData(userID);\n\n        return Promise.resolve(response);\n    }\n\n    public async requestCustomGrant(\n        customGrantParams: CustomGrantConfig,\n        userID?: string\n    ): Promise<TokenResponse | FetchResponse> {\n        const oidcProviderMetadata: OIDCProviderMetaData = await this._oidcProviderMetaData();\n        const configData: StrictAuthClientConfig = await this._config();\n\n        let tokenEndpoint: string | undefined;\n\n        if (customGrantParams.tokenEndpoint && customGrantParams.tokenEndpoint.trim().length !== 0) {\n            tokenEndpoint = customGrantParams.tokenEndpoint;\n        } else {\n            tokenEndpoint = oidcProviderMetadata.token_endpoint;\n        }\n\n        if (!tokenEndpoint || tokenEndpoint.trim().length === 0) {\n            throw new AsgardeoAuthException(\n                \"JS-AUTH_CORE-RCG-NF01\",\n                \"Token endpoint not found.\",\n                \"No token endpoint was found in the OIDC provider meta data returned by the well-known endpoint \" +\n                \"or the token endpoint passed to the SDK is empty.\"\n            );\n        }\n\n        const data: string[] = await Promise.all(\n            Object.entries(customGrantParams.data).map(async ([ key, value ]: [ key: string, value: any ]) => {\n                const newValue: string = await this._authenticationHelper.replaceCustomGrantTemplateTags(\n                    value as string,\n                    userID\n                );\n\n                return `${ key }=${ newValue }`;\n            })\n        );\n\n        let requestHeaders: Record<string, any> = {\n            ...AuthenticationUtils.getTokenRequestHeaders()\n        };\n\n        if (customGrantParams.attachToken) {\n            requestHeaders = {\n                ...requestHeaders,\n                Authorization: `Bearer ${ (await this._dataLayer.getSessionData(userID)).access_token }`\n            };\n        }\n\n        const requestConfig: FetchRequestConfig = {\n            body: data.join(\"&\"),\n            credentials: configData.sendCookiesInRequests\n                ? FetchCredentialTypes.Include\n                : FetchCredentialTypes.SameOrigin,\n            headers: new Headers(requestHeaders),\n            method: \"POST\"\n        };\n\n        let response: Response;\n\n        try {\n            response = await fetch(tokenEndpoint, requestConfig);\n        } catch (error: any) {\n            throw new AsgardeoAuthException(\n                \"JS-AUTH_CORE-RCG-NE02\",\n                \"The custom grant request failed.\",\n                error ?? \"The request sent to get the custom grant failed.\"\n            );\n        }\n\n        if (response.status !== 200 || !response.ok) {\n            throw new AsgardeoAuthException(\n                \"JS-AUTH_CORE-RCG-HE03\",\n                `Invalid response status received for the custom grant request. (${response.statusText})`,\n                await response.json()\n            );\n        }\n\n        if (customGrantParams.returnsSession) {\n            return this._authenticationHelper.handleTokenResponse(response, userID);\n        } else {\n            return Promise.resolve(await response.json());\n        }\n    }\n\n    public async getBasicUserInfo(userID?: string): Promise<BasicUserInfo> {\n        const sessionData: SessionData = await this._dataLayer.getSessionData(userID);\n        const authenticatedUser: AuthenticatedUserInfo = this._authenticationHelper\n            .getAuthenticatedUserInfo(sessionData?.id_token);\n\n        let basicUserInfo: BasicUserInfo = {\n            allowedScopes: sessionData.scope,\n            sessionState: sessionData.session_state\n        };\n\n        Object.keys(authenticatedUser).forEach((key: string) => {\n            if (\n                authenticatedUser[ key ] === undefined ||\n                authenticatedUser[ key ] === \"\" ||\n                authenticatedUser[ key ] === null\n            ) {\n                delete authenticatedUser[ key ];\n            }\n        });\n\n        basicUserInfo = { ...basicUserInfo, ...authenticatedUser };\n\n        return basicUserInfo;\n    }\n\n    public async getDecodedIDToken(userID?: string): Promise<DecodedIDTokenPayload> {\n        const idToken: string = (await this._dataLayer.getSessionData(userID)).id_token;\n        const payload: DecodedIDTokenPayload = this._cryptoHelper.decodeIDToken(idToken);\n\n        return payload;\n    }\n\n    public async getCryptoHelper(): Promise<CryptoHelper> {\n        return this._cryptoHelper;\n    }\n\n    public async getIDToken(userID?: string): Promise<string> {\n        return (await this._dataLayer.getSessionData(userID)).id_token;\n    }\n\n    public async getOIDCProviderMetaData(forceInit: boolean): Promise<void> {\n        const configData: StrictAuthClientConfig = await this._config();\n\n        if (!forceInit && (await this._dataLayer.getTemporaryDataParameter(OP_CONFIG_INITIATED))) {\n            return Promise.resolve();\n        }\n\n        const wellKnownEndpoint: string = (configData as any).wellKnownEndpoint;\n\n        if (wellKnownEndpoint) {\n\n            let response: Response;\n\n            try {\n                response = await fetch(wellKnownEndpoint);\n                if (response.status !== 200 || !response.ok) {\n                    throw new Error();\n                }\n            } catch {\n                throw new AsgardeoAuthException(\n                    \"JS-AUTH_CORE-GOPMD-HE01\",\n                    \"Invalid well-known response\",\n                    \"The well known endpoint response has been failed with an error.\"\n                );\n            }\n\n            await this._dataLayer.setOIDCProviderMetaData(\n                await this._authenticationHelper.resolveEndpoints(await response.json())\n            );\n            await this._dataLayer.setTemporaryDataParameter(OP_CONFIG_INITIATED, true);\n\n            return Promise.resolve();\n        } else if ((configData as any).baseUrl) {\n            try {\n                await this._dataLayer.setOIDCProviderMetaData(\n                    await this._authenticationHelper.resolveEndpointsByBaseURL());\n            } catch (error: any) {\n                throw new AsgardeoAuthException(\n                    \"JS-AUTH_CORE-GOPMD-IV02\",\n                    \"Resolving endpoints failed.\",\n                    error ?? \"Resolving endpoints by base url failed.\"\n                );\n            }\n            await this._dataLayer.setTemporaryDataParameter(OP_CONFIG_INITIATED, true);\n\n            return Promise.resolve();\n        }  else {\n            await this._dataLayer.setOIDCProviderMetaData(\n                await this._authenticationHelper.resolveEndpointsExplicitly());\n\n            await this._dataLayer.setTemporaryDataParameter(OP_CONFIG_INITIATED, true);\n\n            return Promise.resolve();\n        }\n    }\n\n    public async getOIDCServiceEndpoints(): Promise<OIDCEndpoints> {\n        const oidcProviderMetaData: OIDCProviderMetaData = await this._oidcProviderMetaData();\n\n        return {\n            authorizationEndpoint: oidcProviderMetaData.authorization_endpoint ?? \"\",\n            checkSessionIframe: oidcProviderMetaData.check_session_iframe ?? \"\",\n            endSessionEndpoint: oidcProviderMetaData.end_session_endpoint ?? \"\",\n            introspectionEndpoint: oidcProviderMetaData.introspection_endpoint ?? \"\",\n            issuer: oidcProviderMetaData.issuer ?? \"\",\n            jwksUri: oidcProviderMetaData.jwks_uri ?? \"\",\n            registrationEndpoint: oidcProviderMetaData.registration_endpoint ?? \"\",\n            revocationEndpoint: oidcProviderMetaData.revocation_endpoint ?? \"\",\n            tokenEndpoint: oidcProviderMetaData.token_endpoint ?? \"\",\n            userinfoEndpoint: oidcProviderMetaData.userinfo_endpoint ?? \"\"\n        };\n    }\n\n    public async getSignOutURL(userID?: string): Promise<string> {\n        const logoutEndpoint: string | undefined = (await this._oidcProviderMetaData())?.end_session_endpoint;\n        const configData: StrictAuthClientConfig = await this._config();\n\n        if (!logoutEndpoint || logoutEndpoint.trim().length === 0) {\n            throw new AsgardeoAuthException(\n                \"JS-AUTH_CORE-GSOU-NF01\",\n                \"Sign-out endpoint not found.\",\n                \"No sign-out endpoint was found in the OIDC provider meta data returned by the well-known endpoint \" +\n                \"or the sign-out endpoint passed to the SDK is empty.\"\n            );\n        }\n\n        const callbackURL: string = configData?.signOutRedirectURL ?? configData?.signInRedirectURL;\n\n        if (!callbackURL || callbackURL.trim().length === 0) {\n            throw new AsgardeoAuthException(\n                \"JS-AUTH_CORE-GSOU-NF03\",\n                \"No sign-out redirect URL found.\",\n                \"The sign-out redirect URL cannot be found or the URL passed to the SDK is empty. \" +\n                \"No sign-in redirect URL has been found either. \"\n            );\n        }\n        const queryParams: URLSearchParams = new URLSearchParams();\n\n        queryParams.set(\"post_logout_redirect_uri\", callbackURL);\n\n        if (configData.sendIdTokenInLogoutRequest) {\n            const idToken: string = (await this._dataLayer.getSessionData(userID))?.id_token;\n\n            if (!idToken || idToken.trim().length === 0) {\n                throw new AsgardeoAuthException(\n                    \"JS-AUTH_CORE-GSOU-NF02\",\n                    \"ID token not found.\",\n                    \"No ID token could be found. Either the session information is lost or you have not signed in.\"\n                );\n            }\n            queryParams.set(\"id_token_hint\", idToken);\n        } else {\n            queryParams.set(\"client_id\", configData.clientID);\n        }\n\n        queryParams.set(\"state\", SIGN_OUT_SUCCESS_PARAM);\n\n        return `${logoutEndpoint}?${queryParams.toString()}`;\n    }\n\n    public async clearUserSessionData(userID?: string): Promise<void> {\n        await this._authenticationHelper.clearUserSessionData(userID);\n    }\n\n    public async getAccessToken(userID?: string): Promise<string> {\n        return (await this._dataLayer.getSessionData(userID))?.access_token;\n    }\n\n    /**\n     * The created timestamp of the token response in milliseconds.\n     * \n     * @param userID - User ID\n     * @returns Created at timestamp of the token response in milliseconds.\n     */\n    public async getCreatedAt(userID?: string): Promise<number> {\n        return (await this._dataLayer.getSessionData(userID))?.created_at;\n    }\n\n    /**\n     * The expires timestamp of the token response in seconds.\n     * \n     * @param userID - User ID\n     * @returns Expires in timestamp of the token response in seconds.\n     */\n    public async getExpiresIn(userID?: string): Promise<string> {\n        return (await this._dataLayer.getSessionData(userID))?.expires_in;\n    }\n\n    public async isAuthenticated(userID?: string): Promise<boolean> {\n        const isAccessTokenAvailable: boolean = Boolean(await this.getAccessToken(userID));\n\n        // Check if the access token is expired.\n        const createdAt: number = await this.getCreatedAt(userID);\n\n        // Get the expires in value.\n        const expiresInString: string = await this.getExpiresIn(userID);\n\n        // If the expires in value is not available, the token is invalid and the user is not authenticated.\n        if (!expiresInString) {\n            return false;\n        }\n\n        // Convert to milliseconds.\n        const expiresIn: number = parseInt(expiresInString) * 1000;\n        const currentTime: number = new Date().getTime();\n        const isAccessTokenValid: boolean = (createdAt + expiresIn) > currentTime;\n\n        const isAuthenticated: boolean = isAccessTokenAvailable && isAccessTokenValid;\n\n        return isAuthenticated;\n    }\n\n    public async getPKCECode(state: string, userID?: string): Promise<string> {\n        return (await this._dataLayer.getTemporaryDataParameter(\n            AuthenticationUtils.extractPKCEKeyFromStateParam(state),\n            userID\n        )) as string;\n    }\n\n    public async setPKCECode(pkce: string, state: string, userID?: string): Promise<void> {\n        return await this._dataLayer.setTemporaryDataParameter(\n            AuthenticationUtils.extractPKCEKeyFromStateParam(state),\n            pkce,\n            userID\n        );\n    }\n\n    public async updateConfig(config: Partial<AuthClientConfig<T>>): Promise<void> {\n        await this._dataLayer.setConfigData(config);\n        await this.getOIDCProviderMetaData(true);\n    }\n}\n","/**\n * Copyright (c) 2020, WSO2 LLC. (https://www.wso2.com). All Rights Reserved.\n *\n * WSO2 LLC. licenses this file to you under the Apache License,\n * Version 2.0 (the \"License\"); you may not use this file except\n * in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied. See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { Stores } from \"../constants\";\nimport { AuthClientConfig, OIDCProviderMetaData, SessionData, Store, StoreValue, TemporaryData } from \"../models\";\n\ntype PartialData<T> = Partial<AuthClientConfig<T> | OIDCProviderMetaData | SessionData | TemporaryData>;\n\nexport const ASGARDEO_SESSION_ACTIVE: string = \"asgardeo-session-active\";\n\nexport class DataLayer<T> {\n    protected _id: string;\n    protected _store: Store;\n    public constructor(instanceID: string, store: Store) {\n        this._id = instanceID;\n        this._store = store;\n    }\n\n    protected async setDataInBulk(\n        key: string,\n        data: PartialData<T>\n    ): Promise<void> {\n        const existingDataJSON: string = (await this._store.getData(key)) ?? null;\n        const existingData: PartialData<T> = existingDataJSON && JSON.parse(existingDataJSON);\n\n        const dataToBeSaved: PartialData<T> = { ...existingData, ...data };\n        const dataToBeSavedJSON: string = JSON.stringify(dataToBeSaved);\n\n        await this._store.setData(key, dataToBeSavedJSON);\n    }\n\n    protected async setValue(\n        key: string,\n        attribute: keyof AuthClientConfig<T> | keyof OIDCProviderMetaData | keyof SessionData | keyof TemporaryData,\n        value: StoreValue\n    ): Promise<void> {\n        const existingDataJSON: string = (await this._store.getData(key)) ?? null;\n        const existingData: PartialData<T> = existingDataJSON && JSON.parse(existingDataJSON);\n\n        const dataToBeSaved: PartialData<T> = { ...existingData, [ attribute ]: value };\n        const dataToBeSavedJSON: string = JSON.stringify(dataToBeSaved);\n\n        await this._store.setData(key, dataToBeSavedJSON);\n    }\n\n    protected async removeValue(\n        key: string,\n        attribute: (keyof AuthClientConfig<T> | keyof OIDCProviderMetaData | keyof SessionData | keyof TemporaryData)\n    ): Promise<void> {\n        const existingDataJSON: string = (await this._store.getData(key)) ?? null;\n        const existingData: PartialData<T> = existingDataJSON && JSON.parse(existingDataJSON);\n\n        const dataToBeSaved: PartialData<T> = { ...existingData };\n\n        delete dataToBeSaved[ attribute as string ];\n\n        const dataToBeSavedJSON: string = JSON.stringify(dataToBeSaved);\n\n        await this._store.setData(key, dataToBeSavedJSON);\n    }\n\n    protected _resolveKey(store: Stores | string, userID?: string): string {\n        return userID ? `${ store }-${ this._id }-${ userID }` : `${ store }-${ this._id }`;\n    }\n\n    protected isLocalStorageAvailable(): boolean {\n        try {\n            const testValue: string = \"__ASGARDEO_AUTH_CORE_LOCAL_STORAGE_TEST__\";\n\n            localStorage.setItem(testValue, testValue);\n            localStorage.removeItem(testValue);\n\n            return true;\n        } catch (error) {\n            return false;\n        }\n    }\n\n    public async setConfigData(config: Partial<AuthClientConfig<T>>): Promise<void> {\n        await this.setDataInBulk(this._resolveKey(Stores.ConfigData), config);\n    }\n\n    public async setOIDCProviderMetaData(oidcProviderMetaData: Partial<OIDCProviderMetaData>): Promise<void> {\n        this.setDataInBulk(this._resolveKey(Stores.OIDCProviderMetaData), oidcProviderMetaData);\n    }\n\n    public async setTemporaryData(temporaryData: Partial<TemporaryData>, userID?: string): Promise<void> {\n        this.setDataInBulk(this._resolveKey(Stores.TemporaryData, userID), temporaryData);\n    }\n\n    public async setSessionData(sessionData: Partial<SessionData>, userID?: string): Promise<void> {\n        this.setDataInBulk(this._resolveKey(Stores.SessionData, userID), sessionData);\n    }\n\n    public async setCustomData<K>(key: string, customData: Partial<K>, userID?: string): Promise<void> {\n        this.setDataInBulk(this._resolveKey(key, userID), customData);\n    }\n\n    public async getConfigData(): Promise<AuthClientConfig<T>> {\n        return JSON.parse((await this._store.getData(this._resolveKey(Stores.ConfigData))) ?? null);\n    }\n\n    public async getOIDCProviderMetaData(): Promise<OIDCProviderMetaData> {\n        return JSON.parse((await this._store.getData(this._resolveKey(Stores.OIDCProviderMetaData))) ?? null);\n    }\n\n    public async getTemporaryData(userID?: string): Promise<TemporaryData> {\n        return JSON.parse((await this._store.getData(this._resolveKey(Stores.TemporaryData, userID))) ?? null);\n    }\n\n    public async getSessionData(userID?: string): Promise<SessionData> {\n        return JSON.parse((await this._store.getData(this._resolveKey(Stores.SessionData, userID))) ?? null);\n    }\n\n    public async getCustomData<K>(key: string, userID?: string): Promise<K> {\n        return JSON.parse((await this._store.getData(this._resolveKey(key, userID))) ?? null);\n    }\n\n    public setSessionStatus(status: string): void {\n        // Using local storage to store the session status as it is required to be available across tabs.\n        this.isLocalStorageAvailable() && localStorage.setItem(`${ASGARDEO_SESSION_ACTIVE}`, status);\n    }\n\n    public getSessionStatus(): string {\n        return this.isLocalStorageAvailable() \n            ? localStorage.getItem(`${ASGARDEO_SESSION_ACTIVE}`) ?? \"\"\n            : \"\";\n    }\n\n    public removeSessionStatus(): void {\n        this.isLocalStorageAvailable() && localStorage.removeItem(`${ASGARDEO_SESSION_ACTIVE}`);\n    }\n\n    public async removeConfigData(): Promise<void> {\n        await this._store.removeData(this._resolveKey(Stores.ConfigData));\n    }\n\n    public async removeOIDCProviderMetaData(): Promise<void> {\n        await this._store.removeData(this._resolveKey(Stores.OIDCProviderMetaData));\n    }\n\n    public async removeTemporaryData(userID?: string): Promise<void> {\n        await this._store.removeData(this._resolveKey(Stores.TemporaryData, userID));\n    }\n\n    public async removeSessionData(userID?: string): Promise<void> {\n        await this._store.removeData(this._resolveKey(Stores.SessionData, userID));\n    }\n\n    public async getConfigDataParameter(key: keyof AuthClientConfig<T>): Promise<StoreValue> {\n        const data: string = await this._store.getData(this._resolveKey(Stores.ConfigData));\n\n        return data && JSON.parse(data)[ key ];\n    }\n\n    public async getOIDCProviderMetaDataParameter(key: keyof OIDCProviderMetaData): Promise<StoreValue> {\n        const data: string = await this._store.getData(this._resolveKey(Stores.OIDCProviderMetaData));\n\n        return data && JSON.parse(data)[ key ];\n    }\n\n    public async getTemporaryDataParameter(key: keyof TemporaryData, userID?: string): Promise<StoreValue> {\n        const data: string = await this._store.getData(this._resolveKey(Stores.TemporaryData, userID));\n\n        return data && JSON.parse(data)[ key ];\n    }\n\n    public async getSessionDataParameter(key: keyof SessionData, userID?: string): Promise<StoreValue> {\n        const data: string = await this._store.getData(this._resolveKey(Stores.SessionData, userID));\n\n        return data && JSON.parse(data)[ key ];\n    }\n\n    public async setConfigDataParameter(key: keyof AuthClientConfig<T>, value: StoreValue): Promise<void> {\n        await this.setValue(this._resolveKey(Stores.ConfigData), key, value);\n    }\n\n    public async setOIDCProviderMetaDataParameter(key: keyof OIDCProviderMetaData, value: StoreValue): Promise<void> {\n        await this.setValue(this._resolveKey(Stores.OIDCProviderMetaData), key, value);\n    }\n\n    public async setTemporaryDataParameter(\n        key: keyof TemporaryData,\n        value: StoreValue,\n        userID?: string\n    ): Promise<void> {\n        await this.setValue(this._resolveKey(Stores.TemporaryData, userID), key, value);\n    }\n\n    public async setSessionDataParameter(key: keyof SessionData, value: StoreValue, userID?: string): Promise<void> {\n        await this.setValue(this._resolveKey(Stores.SessionData, userID), key, value);\n    }\n\n    public async removeConfigDataParameter(key: keyof AuthClientConfig<T>): Promise<void> {\n        await this.removeValue(this._resolveKey(Stores.ConfigData), key);\n    }\n\n    public async removeOIDCProviderMetaDataParameter(key: keyof OIDCProviderMetaData): Promise<void> {\n        await this.removeValue(this._resolveKey(Stores.OIDCProviderMetaData), key);\n    }\n\n    public async removeTemporaryDataParameter(key: keyof TemporaryData, userID?: string): Promise<void> {\n        await this.removeValue(this._resolveKey(Stores.TemporaryData, userID), key);\n    }\n\n    public async removeSessionDataParameter(key: keyof SessionData, userID?: string): Promise<void> {\n        await this.removeValue(this._resolveKey(Stores.SessionData, userID), key);\n    }\n}\n","/**\n * Copyright (c) 2020, WSO2 LLC. (https://www.wso2.com). All Rights Reserved.\n *\n * WSO2 LLC. licenses this file to you under the Apache License,\n * Version 2.0 (the \"License\"); you may not use this file except\n * in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied. See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport {\n    OIDC_SCOPE,\n    OP_CONFIG_INITIATED,\n    ResponseMode,\n    SIGN_OUT_SUCCESS_PARAM,\n    STATE\n} from \"./constants\";\nimport { AuthenticationCore } from \"./core\";\nimport { DataLayer } from \"./data\";\nimport { CryptoHelper } from \"./helpers\";\nimport {\n    AuthClientConfig,\n    BasicUserInfo,\n    CryptoUtils,\n    CustomGrantConfig,\n    DecodedIDTokenPayload,\n    FetchResponse,\n    GetAuthURLConfig,\n    OIDCEndpoints,\n    Store,\n    TokenResponse\n} from \"./models\";\n\n/**\n * Default configurations.\n */\nconst DefaultConfig: Partial<AuthClientConfig<unknown>> = {\n    clockTolerance: 300,\n    enablePKCE: true,\n    responseMode: ResponseMode.query,\n    scope: [ OIDC_SCOPE ],\n    sendCookiesInRequests: true,\n    validateIDToken: true,\n    validateIDTokenIssuer: true\n};\n\n/**\n * This class provides the necessary methods needed to implement authentication.\n*/\nexport class AsgardeoAuthClient<T> {\n    private _dataLayer!: DataLayer<T>;\n    private _authenticationCore!: AuthenticationCore<T>;\n\n    private static _instanceID: number;\n    static _authenticationCore: any;\n\n    /**\n     * This is the constructor method that returns an instance of the .\n     *\n     * @param store - The store object.\n     *\n     * @example\n     * ```\n     * const _store: Store = new DataStore();\n     * const auth = new AsgardeoAuthClient<CustomClientConfig>(_store);\n     * ```\n     *\n     * {@link https://github.com/asgardeo/asgardeo-auth-js-sdk/tree/master#constructor}\n     *\n     * @preserve\n     */\n    public constructor() {}\n\n    /**\n     *\n     * This method initializes the SDK with the config data.\n     *\n     * @param config - The config object to initialize with.\n     *\n     * @example\n     * const config = \\{\n     *     signInRedirectURL: \"http://localhost:3000/sign-in\",\n     *     clientID: \"client ID\",\n     *     baseUrl: \"https://localhost:9443\"\n     * \\}\n     *\n     * await auth.initialize(config);\n     *\n     * {@link https://github.com/asgardeo/asgardeo-auth-js-sdk/tree/master#initialize}\n     *\n     * @preserve\n     */\n    public async initialize(\n        config: AuthClientConfig<T>,\n        store: Store,\n        cryptoUtils: CryptoUtils,\n        instanceID?: number\n    ): Promise<void> {\n        const clientId: string = config.clientID;\n\n        if (!AsgardeoAuthClient._instanceID) {\n            AsgardeoAuthClient._instanceID = 0;\n        } else {\n            AsgardeoAuthClient._instanceID += 1;\n        }\n\n        if (instanceID) {\n            AsgardeoAuthClient._instanceID = instanceID;\n        }\n\n        if (!clientId) {\n            this._dataLayer = new DataLayer<T>(`instance_${ AsgardeoAuthClient._instanceID }`, store);\n        } else {\n            this._dataLayer = new DataLayer<T>(`instance_${ AsgardeoAuthClient._instanceID }-${ clientId }`, store);\n        }\n\n        this._authenticationCore = new AuthenticationCore(this._dataLayer, cryptoUtils);\n        AsgardeoAuthClient._authenticationCore = new AuthenticationCore(this._dataLayer, cryptoUtils);\n\n        await this._dataLayer.setConfigData({\n            ...DefaultConfig,\n            ...config,\n            scope: [\n                ...(DefaultConfig.scope ?? []),\n                ...(config.scope?.filter((scope: string) => !DefaultConfig?.scope?.includes(scope)) ?? [])\n            ]\n        });\n    }\n\n    /**\n     * This method returns the `DataLayer` object that allows you to access authentication data.\n     *\n     * @returns - The `DataLayer` object.\n     *\n     * @example\n     * ```\n     * const data = auth.getDataLayer();\n     * ```\n     *\n     * {@link https://github.com/asgardeo/asgardeo-auth-js-sdk/tree/master#getDataLayer}\n     *\n     * @preserve\n     */\n    public getDataLayer(): DataLayer<T> {\n        return this._dataLayer;\n    }\n\n    /**\n     * This method returns the `instanceID` variable of the given instance.\n     *\n     * @returns - The `instanceID` number.\n     *\n     * @example\n     * ```\n     * const instanceId = auth.getInstanceID();\n     * ```\n     *\n     * @preserve\n     */\n    public getInstanceID(): number {\n        return AsgardeoAuthClient._instanceID;\n    }\n\n    /**\n     * This is an async method that returns a Promise that resolves with the authorization URL.\n     *\n     * @param config - (Optional) A config object to force initialization and pass\n     * custom path parameters such as the fidp parameter.\n     * @param userID - (Optional) A unique ID of the user to be authenticated. This is useful in multi-user\n     * scenarios where each user should be uniquely identified.\n     *\n     * @returns - A promise that resolves with the authorization URL.\n     *\n     * @example\n     * ```\n     * auth.getAuthorizationURL().then((url)=>{\n     *  // console.log(url);\n     * }).catch((error)=>{\n     *  // console.error(error);\n     * });\n     * ```\n     *\n     * {@link https://github.com/asgardeo/asgardeo-auth-js-sdk/tree/master#getAuthorizationURL}\n     *\n     * @preserve\n     */\n    public async getAuthorizationURL(config?: GetAuthURLConfig, userID?: string): Promise<string> {\n        const authRequestConfig: GetAuthURLConfig = { ...config };\n\n        delete authRequestConfig?.forceInit;\n\n        if (await this._dataLayer.getTemporaryDataParameter(OP_CONFIG_INITIATED)) {\n            return this._authenticationCore.getAuthorizationURL(authRequestConfig, userID);\n        }\n\n        return this._authenticationCore.getOIDCProviderMetaData(config?.forceInit as boolean).then(() => {\n            return this._authenticationCore.getAuthorizationURL(authRequestConfig, userID);\n        });\n    }\n\n    /**\n     * This is an async method that sends a request to obtain the access token and returns a Promise\n     * that resolves with the token and other relevant data.\n     *\n     * @param authorizationCode - The authorization code.\n     * @param sessionState - The session state.\n     * @param userID - (Optional) A unique ID of the user to be authenticated. This is useful in multi-user\n     * scenarios where each user should be uniquely identified.\n     *\n     * @returns - A Promise that resolves with the token response.\n     *\n     * @example\n     * ```\n     * auth.requestAccessToken(authCode, sessionState).then((token)=>{\n     *  // console.log(token);\n     * }).catch((error)=>{\n     *  // console.error(error);\n     * });\n     * ```\n     *\n     * {@link https://github.com/asgardeo/asgardeo-auth-js-sdk/tree/master#requestAccessToken}\n     *\n     *\n     * @preserve\n     */\n    public async requestAccessToken(\n        authorizationCode: string,\n        sessionState: string,\n        state: string,\n        userID?: string\n    ): Promise<TokenResponse> {\n        if (await this._dataLayer.getTemporaryDataParameter(OP_CONFIG_INITIATED)) {\n            return this._authenticationCore.requestAccessToken(authorizationCode, sessionState, state, userID);\n        }\n\n        return this._authenticationCore.getOIDCProviderMetaData(false).then(() => {\n            return this._authenticationCore.requestAccessToken(authorizationCode, sessionState, state, userID);\n        });\n    }\n\n    /**\n     * This method returns the sign-out URL.\n     *\n     * @param userID - (Optional) A unique ID of the user to be authenticated. This is useful in multi-user\n     * scenarios where each user should be uniquely identified.\n     *\n     * **This doesn't clear the authentication data.**\n     *\n     * @returns - A Promise that resolves with the sign-out URL.\n     *\n     * @example\n     * ```\n     * const signOutUrl = await auth.getSignOutURL();\n     * ```\n     *\n     * {@link https://github.com/asgardeo/asgardeo-auth-js-sdk/tree/master#getSignOutURL}\n     *\n     * @preserve\n     */\n    public async getSignOutURL(userID?: string): Promise<string> {\n        return this._authenticationCore.getSignOutURL(userID);\n    }\n\n    /**\n     * This method returns OIDC service endpoints that are fetched from the `.well-known` endpoint.\n     *\n     * @returns - A Promise that resolves with an object containing the OIDC service endpoints.\n     *\n     * @example\n     * ```\n     * const endpoints = await auth.getOIDCServiceEndpoints();\n     * ```\n     *\n     * {@link https://github.com/asgardeo/asgardeo-auth-js-sdk/tree/master#getOIDCServiceEndpoints}\n     *\n     * @preserve\n     */\n    public async getOIDCServiceEndpoints(): Promise<OIDCEndpoints> {\n        return this._authenticationCore.getOIDCServiceEndpoints();\n    }\n\n    /**\n     * This method decodes the payload of the ID token and returns it.\n     *\n     * @param userID - (Optional) A unique ID of the user to be authenticated. This is useful in multi-user\n     * scenarios where each user should be uniquely identified.\n     *\n     * @returns - A Promise that resolves with the decoded ID token payload.\n     *\n     * @example\n     * ```\n     * const decodedIdToken = await auth.getDecodedIDToken();\n     * ```\n     *\n     * {@link https://github.com/asgardeo/asgardeo-auth-js-sdk/tree/master#getDecodedIDToken}\n     *\n     * @preserve\n     */\n    public async getDecodedIDToken(userID?: string): Promise<DecodedIDTokenPayload> {\n        return this._authenticationCore.getDecodedIDToken(userID);\n    }\n\n    /**\n     * This method returns the ID token.\n     *\n     * @param userID - (Optional) A unique ID of the user to be authenticated. This is useful in multi-user\n     * scenarios where each user should be uniquely identified.\n     *\n     * @returns - A Promise that resolves with the ID token.\n     *\n     * @example\n     * ```\n     * const idToken = await auth.getIDToken();\n     * ```\n     *\n     * {@link https://github.com/asgardeo/asgardeo-auth-js-sdk/tree/master#getIDToken}\n     *\n     * @preserve\n     */\n    public async getIDToken(userID?: string): Promise<string> {\n        return this._authenticationCore.getIDToken(userID);\n    }\n\n    /**\n     * This method returns the basic user information obtained from the ID token.\n     *\n     * @param userID - (Optional) A unique ID of the user to be authenticated. This is useful in multi-user\n     * scenarios where each user should be uniquely identified.\n     *\n     * @returns - A Promise that resolves with an object containing the basic user information.\n     *\n     * @example\n     * ```\n     * const userInfo = await auth.getBasicUserInfo();\n     * ```\n     *\n     * {@link https://github.com/asgardeo/asgardeo-auth-js-sdk/tree/master#getBasicUserInfo}\n     *\n     * @preserve\n     */\n    public async getBasicUserInfo(userID?: string): Promise<BasicUserInfo> {\n        return this._authenticationCore.getBasicUserInfo(userID);\n    }\n\n    /**\n     * This method returns the crypto helper object.\n     *\n     * @returns - A Promise that resolves with a CryptoHelper object.\n     *\n     * @example\n     * ```\n     * const cryptoHelper = await auth.CryptoHelper();\n     * ```\n     *\n     * {@link https://github.com/asgardeo/asgardeo-auth-js-sdk/tree/master#getCryptoHelper}\n     *\n     * @preserve\n     */\n    public async getCryptoHelper(): Promise<CryptoHelper> {\n        return this._authenticationCore.getCryptoHelper();\n    }\n\n    /**\n     * This method revokes the access token.\n     *\n     * @param userID - (Optional) A unique ID of the user to be authenticated. This is useful in multi-user\n     * scenarios where each user should be uniquely identified.\n     *\n     * **This method also clears the authentication data.**\n     *\n     * @returns - A Promise that returns the response of the revoke-access-token request.\n     *\n     * @example\n     * ```\n     * auth.revokeAccessToken().then((response)=>{\n     *  // console.log(response);\n     * }).catch((error)=>{\n     *  // console.error(error);\n     * });\n     * ```\n     *\n     * {@link https://github.com/asgardeo/asgardeo-auth-js-sdk/tree/master#revokeAccessToken}\n     *\n     * @preserve\n     */\n    public revokeAccessToken(userID?: string): Promise<FetchResponse> {\n        return this._authenticationCore.revokeAccessToken(userID);\n    }\n\n    /**\n     * This method refreshes the access token and returns a Promise that resolves with the new access\n     * token and other relevant data.\n     *\n     * @param userID - (Optional) A unique ID of the user to be authenticated. This is useful in multi-user\n     * scenarios where each user should be uniquely identified.\n     *\n     * @returns - A Promise that resolves with the token response.\n     *\n     * @example\n     * ```\n     * auth.refreshAccessToken().then((response)=>{\n     *  // console.log(response);\n     * }).catch((error)=>{\n     *  // console.error(error);\n     * });\n     * ```\n     *\n     * {@link https://github.com/asgardeo/asgardeo-auth-js-sdk/tree/master#refreshAccessToken}\n     *\n     * @preserve\n     */\n    public refreshAccessToken(userID?: string): Promise<TokenResponse> {\n        return this._authenticationCore.refreshAccessToken(userID);\n    }\n\n    /**\n     * This method returns the access token.\n     *\n     * @param userID - (Optional) A unique ID of the user to be authenticated. This is useful in multi-user\n     * scenarios where each user should be uniquely identified.\n     *\n     * @returns - A Promise that resolves with the access token.\n     *\n     * @example\n     * ```\n     * const accessToken = await auth.getAccessToken();\n     * ```\n     *\n     * {@link https://github.com/asgardeo/asgardeo-auth-js-sdk/tree/master#getAccessToken}\n     *\n     * @preserve\n     */\n    public async getAccessToken(userID?: string): Promise<string> {\n        return this._authenticationCore.getAccessToken(userID);\n    }\n\n    /**\n     * This method sends a custom-grant request and returns a Promise that resolves with the response\n     * depending on the config passed.\n     *\n     * @param config - A config object containing the custom grant configurations.\n     * @param userID - (Optional) A unique ID of the user to be authenticated. This is useful in multi-user\n     * scenarios where each user should be uniquely identified.\n     *\n     * @returns - A Promise that resolves with the response depending\n     * on your configurations.\n     *\n     * @example\n     * ```\n     * const config = {\n     *   attachToken: false,\n     *   data: {\n     *       client_id: \"{{clientID}}\",\n     *       grant_type: \"account_switch\",\n     *       scope: \"{{scope}}\",\n     *       token: \"{{token}}\",\n     *   },\n     *   id: \"account-switch\",\n     *   returnResponse: true,\n     *   returnsSession: true,\n     *   signInRequired: true\n     * }\n     *\n     * auth.requestCustomGrant(config).then((response)=>{\n     *  // console.log(response);\n     * }).catch((error)=>{\n     *  // console.error(error);\n     * });\n     * ```\n     *\n     * {@link https://github.com/asgardeo/asgardeo-auth-js-sdk/tree/master#requestCustomGrant}\n     *\n     * @preserve\n     */\n    public requestCustomGrant(config: CustomGrantConfig, userID?: string): Promise<TokenResponse | FetchResponse> {\n        return this._authenticationCore.requestCustomGrant(config, userID);\n    }\n\n    /**\n     * This method returns if the user is authenticated or not.\n     *\n     * @param userID - (Optional) A unique ID of the user to be authenticated. This is useful in multi-user\n     * scenarios where each user should be uniquely identified.\n     *\n     * @returns - A Promise that resolves with `true` if the user is authenticated, `false` otherwise.\n     *\n     * @example\n     * ```\n     * await auth.isAuthenticated();\n     * ```\n     *\n     * {@link https://github.com/asgardeo/asgardeo-auth-js-sdk/tree/master#isAuthenticated}\n     *\n     * @preserve\n     */\n    public async isAuthenticated(userID?: string): Promise<boolean> {\n        return this._authenticationCore.isAuthenticated(userID);\n    }\n\n    /**\n     * This method returns the PKCE code generated during the generation of the authentication URL.\n     *\n     * @param userID - (Optional) A unique ID of the user to be authenticated. This is useful in multi-user\n     * scenarios where each user should be uniquely identified.\n     * @param state - The state parameter that was passed in the authentication URL.\n     *\n     * @returns - A Promise that resolves with the PKCE code.\n     *\n     * @example\n     * ```\n     * const pkce = await getPKCECode();\n     * ```\n     *\n     * {@link https://github.com/asgardeo/asgardeo-auth-js-sdk/tree/master#getPKCECode}\n     *\n     * @preserve\n     */\n    public async getPKCECode(state: string, userID?: string): Promise<string> {\n        return this._authenticationCore.getPKCECode(state, userID);\n    }\n\n    /**\n     * This method sets the PKCE code to the data store.\n     *\n     * @param pkce - The PKCE code.\n     * @param state - The state parameter that was passed in the authentication URL.\n     * @param userID - (Optional) A unique ID of the user to be authenticated. This is useful in multi-user\n     * scenarios where each user should be uniquely identified.\n     *\n     * @example\n     * ```\n     * await auth.setPKCECode(\"pkce_code\")\n     * ```\n     *\n     * {@link https://github.com/asgardeo/asgardeo-auth-js-sdk/tree/master#setPKCECode}\n     *\n     * @preserve\n     */\n    public async setPKCECode(pkce: string, state: string, userID?: string): Promise<void> {\n        await this._authenticationCore.setPKCECode(pkce, state, userID);\n    }\n\n    /**\n     * This method returns if the sign-out is successful or not.\n     *\n     * @param signOutRedirectUrl - The URL to which the user has been redirected to after signing-out.\n     *\n     * **The server appends path parameters to the `signOutRedirectURL` and these path parameters\n     *  are required for this method to function.**\n     *\n     * @returns - `true` if successful, `false` otherwise.\n     *\n     * {@link https://github.com/asgardeo/asgardeo-auth-js-sdk/tree/master#isSignOutSuccessful}\n     *\n     * @preserve\n     */\n    public static isSignOutSuccessful(signOutRedirectURL: string): boolean {\n        const url: URL = new URL(signOutRedirectURL);\n        const stateParam: string | null = url.searchParams.get(STATE);\n        const error: boolean = Boolean(url.searchParams.get(\"error\"));\n\n        return stateParam ? stateParam === SIGN_OUT_SUCCESS_PARAM && !error : false;\n    }\n\n    /**\n     * This method returns if the sign-out has failed or not.\n     *\n     * @param signOutRedirectUrl - The URL to which the user has been redirected to after signing-out.\n     *\n     * **The server appends path parameters to the `signOutRedirectURL` and these path parameters\n     *  are required for this method to function.**\n     *\n     * @returns - `true` if successful, `false` otherwise.\n     *\n     * {@link https://github.com/asgardeo/asgardeo-auth-js-sdk/tree/master#didSignOutFail}\n     *\n     * @preserve\n     */\n    public static didSignOutFail(signOutRedirectURL: string): boolean {\n        const url: URL = new URL(signOutRedirectURL);\n        const stateParam: string | null = url.searchParams.get(STATE);\n        const error: boolean = Boolean(url.searchParams.get(\"error\"));\n\n        return stateParam ? stateParam === SIGN_OUT_SUCCESS_PARAM && error : false;\n    }\n\n    /**\n     * This method updates the configuration that was passed into the constructor when instantiating this class.\n     *\n     * @param config - A config object to update the SDK configurations with.\n     *\n     * @example\n     * ```\n     * const config = {\n     *     signInRedirectURL: \"http://localhost:3000/sign-in\",\n     *     clientID: \"client ID\",\n     *     baseUrl: \"https://localhost:9443\"\n     * }\n     *\n     * await auth.updateConfig(config);\n     * ```\n     * {@link https://github.com/asgardeo/asgardeo-auth-js-sdk/tree/master#updateConfig}\n     *\n     * @preserve\n     */\n    public async updateConfig(config: Partial<AuthClientConfig<T>>): Promise<void> {\n        await this._authenticationCore.updateConfig(config);\n    }\n\n    public static async clearUserSessionData(userID?: string): Promise<void> {\n        await this._authenticationCore.clearUserSessionData(userID);\n    }\n}\n"],"names":["__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","ResponseMode","SERVICE_RESOURCES","TOKEN_TAG","USERNAME_TAG","SCOPE_TAG","CLIENT_ID_TAG","CLIENT_SECRET_TAG","Stores","REFRESH_TOKEN_TIMER","PKCE_CODE_VERIFIER","PKCE_SEPARATOR","SUPPORTED_SIGNATURE_ALGORITHMS","AUTHORIZATION_CODE","SESSION_STATE","SIGN_OUT_URL","SIGN_OUT_SUCCESS_PARAM","STATE","OIDC_SCOPE","FetchCredentialTypes","AsgardeoAuthException","constructor","code","name","message","this","Object","setPrototypeOf","prototype","AuthenticationUtils","static","payload","optionalizedPayload","assign","iss","aud","exp","iat","acr","amr","azp","auth_time","nonce","c_hash","at_hash","nbf","isk","sid","camelCasedPayload","entries","forEach","key","camelCasedKey","split","map","index","toUpperCase","slice","join","Accept","pkceKey","state","parseInt","stateParam","getTenantDomainFromIdTokenPayload","uidSeparator","tokens","sub","length","AuthenticationHelper","dataLayer","cryptoHelper","_dataLayer","_config","getConfigData","_oidcProviderMetaData","getOIDCProviderMetaData","_cryptoHelper","resolveEndpoints","response","oidcProviderMetaData","configData","endpoints","keys","endpointName","snakeCasedName","replace","letter","toLowerCase","resolveEndpointsExplicitly","requiredEndpoints","every","reqEndpointName","some","resolveEndpointsByBaseURL","baseUrl","defaultEndpoints","authorization_endpoint","end_session_endpoint","issuer","jwks_uri","check_session_iframe","revocation_endpoint","token_endpoint","userinfo_endpoint","validateIdToken","idToken","jwksEndpoint","trim","fetch","credentials","sendCookiesInRequests","Include","SameOrigin","error","status","ok","statusText","json","jwk","getJWKForTheIdToken","isValidIdToken","clientID","decodeIDToken","clockTolerance","_a","validateIDTokenIssuer","getAuthenticatedUserInfo","tenantDomain","username","givenName","_b","given_name","familyName","_c","family_name","fullName","displayName","_d","preferred_username","filterClaimsFromIDTokenPayload","replaceCustomGrantTemplateTags","text","userID","scope","sessionData","getSessionData","includes","push","access_token","id_token","clientSecret","clearUserSessionData","removeTemporaryData","removeSessionData","handleTokenResponse","parsedResponse","created_at","Date","getTime","validateIDToken","setSessionData","tokenResponse","accessToken","createdAt","expiresIn","expires_in","refreshToken","refresh_token","tokenType","token_type","generatePKCEKey","tempData","getTemporaryData","startsWith","lastKey","sort","pop","CryptoHelper","cryptoUtils","_cryptoUtils","getCodeVerifier","base64URLEncode","generateRandomBytes","getCodeChallenge","verifier","hashSha256","jwtHeader","headerJSON","JSON","parse","base64URLDecode","kid","validateJwtIssuer","verifyJwt","utf8String","AuthenticationCore","_authenticationHelper","getAuthorizationURL","config","authorizeEndpoint","getOIDCProviderMetaDataParameter","authorizeRequest","URL","authorizeRequestParams","Map","set","signInRedirectURL","responseMode","enablePKCE","codeVerifier","codeChallenge","setTemporaryDataParameter","prompt","customParams","toString","generateStateParamForRequestCorrelation","searchParams","append","requestAccessToken","authorizationCode","sessionState","tokenEndpoint","setSessionDataParameter","body","URLSearchParams","getTemporaryDataParameter","extractPKCEKeyFromStateParam","removeTemporaryDataParameter","headers","Headers","getTokenRequestHeaders","method","refreshAccessToken","revokeAccessToken","revokeTokenEndpoint","requestCustomGrant","customGrantParams","oidcProviderMetadata","data","all","newValue","requestHeaders","attachToken","Authorization","requestConfig","returnsSession","getBasicUserInfo","authenticatedUser","basicUserInfo","allowedScopes","session_state","undefined","getDecodedIDToken","getCryptoHelper","getIDToken","forceInit","wellKnownEndpoint","Error","setOIDCProviderMetaData","getOIDCServiceEndpoints","authorizationEndpoint","checkSessionIframe","endSessionEndpoint","introspectionEndpoint","introspection_endpoint","_e","jwksUri","_f","registrationEndpoint","_g","registration_endpoint","revocationEndpoint","_h","_j","userinfoEndpoint","_k","getSignOutURL","logoutEndpoint","callbackURL","signOutRedirectURL","queryParams","sendIdTokenInLogoutRequest","getAccessToken","getCreatedAt","getExpiresIn","isAuthenticated","isAccessTokenAvailable","Boolean","expiresInString","currentTime","getPKCECode","setPKCECode","pkce","updateConfig","setConfigData","ASGARDEO_SESSION_ACTIVE","DataLayer","instanceID","store","_id","_store","setDataInBulk","existingDataJSON","getData","existingData","dataToBeSaved","dataToBeSavedJSON","stringify","setData","setValue","attribute","removeValue","_resolveKey","isLocalStorageAvailable","testValue","localStorage","setItem","removeItem","ConfigData","OIDCProviderMetaData","setTemporaryData","temporaryData","TemporaryData","SessionData","setCustomData","customData","getCustomData","setSessionStatus","getSessionStatus","getItem","removeSessionStatus","removeConfigData","removeData","removeOIDCProviderMetaData","getConfigDataParameter","getSessionDataParameter","setConfigDataParameter","setOIDCProviderMetaDataParameter","removeConfigDataParameter","removeOIDCProviderMetaDataParameter","removeSessionDataParameter","DefaultConfig","query","AsgardeoAuthClient","initialize","clientId","_instanceID","_authenticationCore","filter","getDataLayer","getInstanceID","authRequestConfig","url","get"],"mappings":"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"}